

# Vi文本编辑

参考文档：http://c.biancheng.net/view/804.html

### 1 Vi三种工作模式

vi存在三种工作模式，分别为命令模式、输入模式和编辑模式，如下图所示:



![image-20201219101032474](https://wangzaolin.github.io/SoftwareTest/mybook/img/4.1.png)

1）命令模式

使用vi文本编辑，默认处于命令模式，此模式下，可使用方向键（上、下、左、右键）或 k、j、h、i 移动光标的位置，还可以对文件内容进行复制、粘贴、替换、删除等操作。

2）输入模式

在输入模式下，vi可以对文本进行写操作；

在命令模式，通过输入i/I/a/A/o/O插入命令，可进入输入模式；文本输入完成，通过Esc退出按键，可退出输入模式，切换为命令模式；

| 快捷键 | 功能描述                                                     |
| ------ | ------------------------------------------------------------ |
| i      | 在当前光标所在位置之前插入随后输入的文本，光标后的文本相应向右移动 |
| I      | 在光标所在行的行首插入随后输入的文本，行首是该行的第一个非空白字符，相当于光标移动到行首执行 i 命令 |
| o      | 在光标所在行的下面插入新的一行。光标停在空行首，等待输入文本 |
| O      | 在光标所在行的上面插入新的一行。光标停在空行的行首，等待输入文本 |
| a      | 在当前光标所在位置之后插入随后输入的文本                     |
| A      | 在光标所在行的行尾插入随后输入的文本，相当于光标移动到行尾再执行a命令 |

3）编辑模式

编辑模式用于对文件中的指定内容执行保存、查找或替换等操作。

在命令模式状态下按“：”键，此时 Vi 窗口的左下方出现一个“：”符号，这是就可以输入相关指令进行操作了。通过Esc返回命令模式；

## 2 Vi基本操作

### 2.1查找文本

查找文本在命令模式进行操作；

| 输入内容 | 功能描述                         |
| -------- | -------------------------------- |
| /abc     | 从光标所在位置向后查找字符串 abc |
| /^abc    | 查找以 abc 为行首的行            |
| /abc$    | 查找以 abc 为行尾的行            |
| ?abc     | 从光标所在位置向前查找字符串 abc |
| n        | 向后重复上次的查找指令           |
| N        | 向前重复上次的查找指令           |

注意事项：

1、要查找的字符串是严格区分大小写的；如果想忽略大小写，则输入命令 ":set ic"；调整回来输入":set noic"；

2、如果在字符串中出现特殊符号，则需要加上转义字符 "\\"。常见的特殊符号有 \、*、?、$ 等。如果出现这些字符，例如，要查找字符串 "10*"，则需要在命令模式中输入 "/10\\*"。



## 2.2 替换文本

替换文本在编辑模式操作；

| 快捷键          | 功能描述                                   |
| --------------- | ------------------------------------------ |
| :s/a1/a2        | 将光标所在行的第一个a1替换为a2             |
| :s/a1/a2/g      | 将当前光标所在行中的所有 a1 用 a2 替换     |
| :n1,n2s/a1/a2/g | 将文件中 n1 到 n2 行中所有 a1 都用 a2 替换 |
| :%s/a1/a2/g     | 将文件中所有的 a1 都用 a2 替换             |



## 2.3 删除文本

删除文本在命令模式操作；

| 快捷键 | 功能描述                                   |
| ------ | ------------------------------------------ |
| x      | 删除光标所在位置的字符                     |
| dd     | 删除光标所在行                             |
| ndd    | 删除当前行（包括此行）后 n 行文本          |
| dG     | 删除光标所在行一直到文件末尾的所有内容     |
| D      | 删除光标位置(包括光标所在字符)到行尾的内容 |

被删除的内容并没有真正删除，都放在了剪贴板中。将光标移动到指定位置处，按下 "p" 键，就可以将刚才删除的内容又粘贴到此处。



## 2.4 复制粘贴文本

复制粘贴文本在命令模式下操作；

| 快捷键    | 功能描述                                                   |
| --------- | ---------------------------------------------------------- |
| p         | 将剪贴板中的内容粘贴到光标后                               |
| P（大写） | 将剪贴板中的内容粘贴到光标前                               |
| y         | 复制已选中的文本到剪贴板                                   |
| yy        | 将光标所在行复制到剪贴板，此命令前可以加数字 n，可复制多行 |
| yw        | 将光标位置的单词复制到剪贴板                               |



## 2.5 选中文本&光标移动

在命令模式操作；

通过快捷键v，切换到可视模式（编辑器下方显示visual）；

通过上下左右方向键或 k、j、h、i 移动光标选择要选择的文本，或者通过快捷键移动光标，选中文本

快捷方向移动：

| 快捷键 | 功能描述                                               |
| ------ | ------------------------------------------------------ |
| h      | 光标向左移动一位                                       |
| j      | 光标向下移动一行（以回车为换行符），也就是光标向下移动 |
| k      | 光标向上移动一行（也就是向上移动）                     |
| l      | 光标向右移动一位                                       |

以单词为单位移动：

| 快捷键   | 功能描述                            |
| -------- | ----------------------------------- |
| w 或 W   | 光标移动至下一个单词的单词首        |
| b 或 B   | 光标移动至上一个单词的单词首        |
| e 或 E   | 光标移动至下一个单词的单词尾        |
| nw 或 nW | n 为数字，表示光标向右移动 n 个单词 |
| nb 或 nB | n 为数字，表示光标向左移动 n 个单词 |

移动到指定行

| 快捷键 | 功能描述                               |
| ------ | -------------------------------------- |
| ^      | 选中光标所在处到行首的文本             |
| $      | 选中光标所在处到行尾的文本             |
| gg     | 选中光标所在处到文本首行所在的所有文本 |
| G      | 选中光标所在处到文本尾行所在的所有文本 |
| nG     | 选中光标所在处到第n行所在的文本        |
| y      | 将选中的内容复制到剪贴板               |



## 2.6 其他快捷操作

在命令模式操作

| 快捷键        | 功能描述                                                     |
| ------------- | ------------------------------------------------------------ |
| J             | 合并两行文本内容                                             |
| u             | 撤销命令操作，如果要撤销刚才的多次操作，可以多按几次 "u" 键； |
| :set number   | 显示行号                                                     |
| :set nonumber | 取消显示行号                                                 |



## 2.7 保存退出文本

在编辑模式操作

| 命令        | 功能描述                     |
| ----------- | ---------------------------- |
| :wq         | 保存并退出 Vi 编辑器         |
| :wq!        | 保存并强制退出 Vi 编辑器     |
| :q          | 不保存就退出 Vi 编辑器       |
| :q!         | 不保存，且强制退出 Vi 编辑器 |
| :w          | 保存但是不退出 Vim 编辑器    |
| :w!         | 强制保存文本                 |
| :w filename | 另存到 filename 文件         |