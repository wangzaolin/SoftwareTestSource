# pinpoint监控

# 1、pinpoint介绍

## 1.1 pinpoint是什么？

pinpoint是开源在github上的一款APM监控工具，它是由java编写的，用于大规模分布式系统的监控；它对性能的影响最小(只增加约3%资源利用率)，安装agent是无侵入式的，只需要在被测试的Tomcat中加上3句话，打下探针，就可以监控整套程序了。Pinpoint支持的功能比较丰富，可以支持如下几种功能：

- 服务拓扑图：对整个系统中应用的调用关系进行了可视化的展示，单击某个服务节点，可以显示该节点的详细信息，比如当前节点状态、请求数量等
- 实时活跃线程图：监控应用内活跃线程的执行情况，对应用的线程执行性能可以有比较直观的了解
- 请求响应散点图：以时间维度进行请求计数和响应时间的展示，拖过拖动图表可以选择对应的请求查看执行的详细情况
- 请求调用栈查看：对分布式环境中每个请求提供了代码维度的可见性，可以在页面中查看请求针对到代码维度的执行详情，帮助查找请求的瓶颈和故障原因。
- 应用状态、机器状态检查：通过这个功能可以查看相关应用程序的其他的一些详细信息，比如CPU使用情况，内存状态、垃圾收集状态，TPS和JVM信息等参数。

## 1.2 架构组成

pipoint由pinpoint agent、pinpoint collector、pinpoint web、HBase 4部分组成；

- Pinpoint Agent：用于收集应用端监控数据，无侵入式，只需要在启动命令中加入部分参数即可;
- Pinpoint Collector：数据收集模块，接收Agent发送过来的监控数据，并存储到HBase;
- Pinpoint Web：监控展示模块，展示系统调用关系、调用详情、应用状态等，并支持报警等功能;
- HBase：数据库，用于保存监控数据；

架构图如下：

![image-20210320102535239](D:\GitBook\SoftwareSource\mybook\img\image-20210320102535239.png)

# 2、pinpoint安装部署

## 2.1 环境准备

1）2台centos虚拟机，1台用于部署pinpoint主程序以及HBse;1台用于部署应用系统和pinpoint agent；

2）jdk7 --- Java运行环境

3）hbase-1.0.3-bin.tar.gz --- 数据库，用来存储监控信息

4）tomcat8.0 --- Web服务器

5）pinpoint-collector-1.5.2.war --- pp的控制器

6）pinpoint-web-1.5.2.war --- pp展示页面

7）pp-collector.init --- 用来快速启动pp-col，不要也可以

8）pp-web.init --- 用来快速启动pp-web，不要也可以

安装包下载地址：

链接：https://pan.baidu.com/s/1bRE896x5ydc_n2mpus1hVw 
提取码：7f6z 

## 2.2 HBase安装

1）将安装包hbase-1.0.3-bin.tar.gz上传到服务器/home/pp_res目录，并解压；

```
tar -xzvf hbase-1.0.3-bin.tar.gz
```

2）修改HBase配置文件hbase-site.xml

vi /home/pp_res/hbase-1.0.3/conf/hbase-site.xml

在末尾添加configuration内容

```
<configuration> 
 <property> 
 <name>hbase.rootdir</name> 
 <value>file:///data/hbase</value> 
 </property> 
</configuration> 
```

3）修改启动文件**hbase-env.sh的JAVA_HOME环境变量位置**

vi /home/pp_res/hbase-1.0.3/conf/hbase-env.sh

修改JAVA_HOME环境变量的值为JDK的安装路径；

export JAVA_HOME=/usr/**local**/java/jdk1.8

注：java_home的地址可通过echo $JAVA_HOME获取；

4）配置环境变量

配置环境变量HBASE_HOME

vi /etc/profile

在末尾添加：

export HBASE_HOME=/home/pp_res/hbase-1.0.3

让环境变量生效

source /etc/profile

5）启动HBase

执行命令：

cd /home/pp_res/hbase-1.0.3/bin 

./start-hbase.sh 

验证是否启动成功：

执行命令:jps

启动成功会看到HMaster进程；

![image-20210320143043555](D:\GitBook\SoftwareSource\mybook\img\image-20210320143043555.png)



5）初始化HBase的pinpoint库

执行pinpoint提供的Hbase初始化语句

执行命令：

```
cd /home/pp_res/hbase-1.0.3/bin
./hbase shell /home/pp_res/hbase-create.hbase 
```

执行结果：

![image-20210320172812967](D:\GitBook\SoftwareSource\mybook\img\image-20210320172812967.png)

结果验证：

- 进入HBase数据库

执行命令：./hbase shell

- 查看初始化表

方法1

执行命令：status 'detailed'，可查看初始化表的数据；

方法2

登录web，查看初始化数据是否成功；

HbaseWeb地址 : http://192.168.197.129:16010/master-status 

![image-20210320173445788](D:\GitBook\SoftwareSource\mybook\img\image-20210320173445788.png)



